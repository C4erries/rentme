## План по реализации ML‑сервиса ценообразования

План намеренно укрупнён, без сильного дробления шагов.

1. **Зафиксировать целевую схему признаков**
   - Согласовать список полей `Listing`, которые участвуют в ценообразовании (этаж, этажность, площади, локация, ограничения, тип, рейтинг).
   - Принять решение по добавлению недостающих полей в доменную модель (минимум: `Floor`, `FloorsTotal`, `LivingAreaSquareMeters`, `KitchenAreaSquareMeters`, обобщённый признак близости к транспорту).

2. **Подготовить единую модель данных для обучения**
   - Определить формат «snapshot`а Listing» для ML (см. `readme.md`).
   - Реализовать (или спроектировать) генератор данных, который:
     - создаёт фикстуры для `backend/data/listings.json`;
     - на их основе формирует ML‑датасет с теми же полями и целевой ценой (`NightlyRateCents` или её аналог).

3. **Собрать и зафиксировать базовую ML‑модель**
   - На стороне `mlrent` выбрать простую модель регрессии (линейная модель / дерево решений) и обучить её на подготовленном датасете.
   - Оценить качество на `clean_test`‑подмножестве, зафиксировать метрики и важность признаков.
   - Сохранить артефакт модели (например, pickle/ONNX) для использования в сервисе.

4. **Обёрнуть модель в ML‑сервис**
   - Спроектировать небольшой HTTP‑сервис (Python + FastAPI/Flask) с эндпоинтом `POST /predict`, принимающим snapshot квартиры и возвращающим рекомендованную ночную цену.
   - Добавить минимальное логирование запросов/ответов и ошибок, чтобы удобно анализировать работу сервиса.

5. **Интегрировать ML‑сервис в Go‑бэкенд**
   - Реализовать инфраструктурный адаптер `MLPricingEngine`, который:
     - по `QuoteInput{ ListingID, Range, Guests }` достаёт `Listing` из UoW;
     - превращает его в snapshot для ML‑сервиса;
     - вызывает `POST /predict` и переводит результат в `PriceBreakdown`.
   - Зарегистрировать этот адаптер как реализацию `pricing.Calculator` и `PricingPort` в `cmd/rentme/main.go` (параллельно сохранив возможность использовать старый `memory.PricingEngine` для dev).

6. **Подключить к существующим сценариям и добавить наблюдаемость**
   - Убедиться, что `HostListingPriceSuggestionHandler` использует новый `PricingPort` и корректно отдаёт рекомендованную цену.
   - Добавить структурированные логи (через `obs.NewLogger` / `slog`) для:
     - обращений к ML‑сервису;
     - ошибок и таймаутов;
     - ключевых метрик (входные фичи, предсказанная цена, расхождение с текущей ценой).
   - При необходимости предусмотреть флаги/конфиг для включения/выключения ML‑сервиса и fallback на простое ценообразование.

