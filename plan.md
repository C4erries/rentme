## Общий план развития Rentme (MVP -> демо-ready)

Цель: довести учебный маркетплейс аренды жилья (аналог Airbnb) до состояния **стабильного демо**, где воспроизводимо работают ключевые сценарии (каталог -> карточка -> бронь -> чат -> отзыв) для `short_term` и `long_term`, плюс админ-инструменты и ML-подсказка цены.

### Критерий “demo-ready”
- `docker compose up --build` поднимает все сервисы **с нуля** без ручных шагов.
- Демо-сценарии из `demo.md` проходят без падений/паник и без “битых” экранов.
- При недоступности внешних зависимостей (ML, messaging) система деградирует предсказуемо: понятная ошибка пользователю + структурированный лог на backend.

### Статус (15 задач)
- [x] 1) Listing: доменная модель и UX мастера
- [x] 2) ML pricing: short_term/long_term и интеграция в backend
- [x] 3) Фото: загрузка через S3/MinIO end-to-end
- [x] 4) Бронирование: создание брони и UX для гостя
- [x] 5) Лендинг и отзывы: рабочие страницы и отзывы end-to-end
- [x] 6) Мессенджер: gRPC + ScyllaDB, интеграция с backend
- [x] 7) Уведомления: минимальные оповещения без Kafka
- [x] 8) Админка: список пользователей, админ-чат, метрики ML
- [x] 9) Docker Compose: все сервисы через compose, Kafka убрана
- [x] 10) Полировка: тексты, логи, UX, документация
- [ ] 11) Личный кабинет гостя: финальные правки и проверки (опционально)
- [x] 12) Переключатель типа аренды в каталоге (short_term/long_term) и фильтрация
- [x] 13) Цена/единица тарифа: отображение "ночь/месяц", `rate_rub` + `price_unit`
- [ ] 14) UX улучшения и финальные правки (stretch)
- [ ] 15) Адекватизация ML-цены: нормализация города + клампы + пересборка датасетов

---

### 11) Личный кабинет гостя (опционально, но сильно улучшает демо)
Цель: у гостя есть одно место, где видно “что я уже сделал/забронировал” и куда идти дальше.

**Требования (минимум):**
- Раздел “Мои брони”: предстоящие / прошлые / отменённые.
- Деталка брони: даты, сумма, статус, ссылка на объявление, ссылка/кнопка “Написать хосту”.
- Раздел “Сообщения”: быстрый переход к списку диалогов/конкретному диалогу (если уже есть в UI).
- Раздел “Отзывы”: если есть завершённые брони без отзыва — показать CTA “Оставить отзыв”.

**Что проверить / критерии готовности:**
- Гостевой кабинет корректно работает с “пустыми” состояниями (нет броней/нет сообщений/нет отзывов).
- Не ломает существующие сценарии каталога/брони/чата.
- Ошибки отображаются понятным текстом (401/403/404/5xx), без “белых экранов”.

---

### 14) UX улучшения и финальные правки (stretch)
Цель: убрать шероховатости, которые портят впечатление на демо, и сделать поведение интерфейса предсказуемым.

**P0 (если что-то из этого отсутствует — доделать):**
- Единый язык цен: всегда показывать `price_unit` (`ночь` для `short_term`, `месяц` для `long_term`), в каталоге и в карточке.
- Единые “empty/loading/error states” для: каталог, карточка объявления, чат, брони, админка.
- Валидации в мастере объявления: понятные сообщения об ошибках до отправки, подсветка полей.
- Навигация: очевидные входы в “Каталог”, “Мои брони”, “Сообщения”, “Профиль”.

**P1 (по времени):**
- Адаптивность (mobile-first) для ключевых экранов: каталог, карточка, чат, мастер объявления.
- Микрокопирайтинг: привести тексты к одному стилю (RU), убрать “заглушки/латиницу” в UI.
- Доступность: фокус-стейты, keyboard navigation в модалках/формах, базовые `aria-label` для иконок.

**Критерии готовности:**
- “Смоук” из `demo.md` можно пройти без подсказок, не упираясь в неочевидные действия.
- Нет критических визуальных багов на ширинах ~360px и ~1280px.

---

### 15) Адекватизация ML-цены
- Нормализовать поле города до канона (минимум `Москва`, `Краснодар`): приводить регистр/пробелы и маппить варианты `Краснодар`, `Краснодар `, `краснодар`, `Krasnodar` -> `Краснодар` (аналогично для `Москва`/`Moscow`).
- Проверить единицы измерения на всём пути: CSV -> обучение -> ответ ML -> backend (рубли/копейки), отдельно для `short_term` (за ночь) и `long_term` (за месяц).
- Привести датасеты к реалистичным диапазонам по городам (Москва/Краснодар) и типам аренды, чтобы модель не училась на "копеечных" примерах.
- Добавить post-processing в backend для демо: "кламп" минимальной цены после ответа ML (конфигурируемые пороги по `city` и `rental_term`) + логирование факта клампа и понятный `message` в ответе.
- Быстрая валидация перед показом: несколько эталонных профилей квартир (например, 20-60 м2, 1-3 комнаты, 0-10 ремонт) и проверка, что прогнозы попадают в разумный коридор.

**Рекомендуемое уточнение критериев (чтобы было что “принять”):**
- Для 2–3 фиксированных профилей квартир по каждому городу/терму прогноз не выходит за заранее заданный коридор (коридоры — в конфиге/таблице, а не “в голове”).
- В логах видно: `city_raw`, `city_normalized`, `rental_term`, `model`, `ml_price_raw`, `ml_price_final`, `clamped=true/false`.
- См. подробный план по ML-части: `mlrent/plan.md`.

---

## Чек-лист приёмки (1–2 часа перед показом)
- С нуля: `docker compose down -v --remove-orphans` -> `docker compose up --build` без ручных миграций/настроек.
- `demo.md` сценарии: guest (каталог/чат/бронь), host (мастер/фото/ML), admin (пользователи/метрики).
- Деградации: остановить `mlpricing` и `messaging-service` по очереди и проверить, что UI показывает понятные ошибки, а backend не падает.
- Проверка данных: в каталоге есть объявления и `short_term`, и `long_term`, у всех есть `host_id` и корректный `price_unit`.

## Техдолг, который мешает “довести до ума” (после демо)
- [ ] Документация: привести `doc.md` в соответствие с проектом или заменить ссылкой на `tz_report_material.md` (сейчас внутри есть нерелевантный текст про “книжный магазин”).
- [ ] Репозиторий: привести `frontend` к нормальному состоянию (явный submodule с `.gitmodules` и инструкцией `git submodule update --init --recursive`).
- [ ] Единый стандарт файлов: все `.md` в UTF-8; убрать “кракозябры” и странные управляющие символы в `domain_model.md`.
